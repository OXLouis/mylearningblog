## Json Web Token 简介

### 三个部分
* header
<img src=http://chuantu.biz/t6/343/1531719528x1729546365.png />
* payload
<img src=http://chuantu.biz/t6/343/1531719418x1729546365.png />
* signature

### 优点
* 因为json的通用性，所以JWT是可以进行跨语言支持的，像JAVA,JavaScript,NodeJS,PHP等很多语言都可以使用。
* 因为有了payload部分，所以JWT可以在自身存储一些其他业务逻辑所必要的非敏感信息。
* 便于传输，jwt的构成非常简单，字节占用很小，所以它是非常便于传输的。
* 它不需要在服务端保存会话信息, 所以它易于应用的扩展

### 缺点
 - 一旦拿到token， 可用它访问服务器，直到过期，中间服务器无法控制它，如是它失效（有解决方案： 在 token中保存信息，可添加额外的验证，如加一个 flag， 把数据库对应的flag失效，来控制token有效性,这样的缺点则是需要在服务端建立数据库）。 
 -  token的过期时间设置很关键，一般把它设到凌晨少人访问时失效，以免用户使用过程中失效而丢失数据。  
 -  token保存的信息有限，且都是字符串。

### 安全相关
* 不应该在jwt的payload部分存放敏感信息，因为该部分是客户端可解密的部分。
* 保护好secret私钥，该私钥非常重要。
* 如果可以，请使用https协议
* 有人提到jwt暴露签名算法（alg），而且会有None（无签名），所以建议隐去alg。一般的协议制定都会考虑扩展性和普适性。但是我们在应用中可以采用我们默认的算法，而不是根据alg去处理。

### 防冒充
#### 加干扰码
服务端在生成token时，使用了客户端的UA作为干扰码对数据加密，客户端进行请求时，会同时传入token、UA，服务端使用UA对token解密，从而验证用户的身份。

如果只是把token拷贝到另一个客户端使用，不同的UA会导致在服务端解析token失败，从而实现了一定程度的防冒充。但是攻击者如果猜到服务端使用UA作为加密钥，他可以修改自己的UA。

#### 有效期
给token加上有效期，即使被冒充也只是在一定的时间段内有效。这不是完美的防御措施，只是尽量减少损失。

服务端在生成token时，加入有效期。每次服务端接收到请求，解析token之后，判断是否已过期，如果过期就拒绝服务。

#### token刷新
如果token过期了，客户端应该对token续期或者重新生成token。这取决于token的过期机制。

1. 服务器缓存token及对应的过期时间
  这个时候就可以采用续期的方式，服务器更新过期时间，token再次有效。
2. token中含有过期时间
  这个时候需要重新生成token。



[理解OAuth 2.0](https://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html)
[什么是JWT](https://www.jianshu.com/p/576dbf44b2ae)